# AgroCodeHack - Задача №3
## Перспективные земли для виноградников

Создание сервиса по поиску перспективных земель для выращивания винограда в Краснодарском крае.

### Условие задачи:

Правильный выбор земельного участка для посадок винограда позволяет производить качественное вино, которое отражает характеристики территории. На хорошем участке можно также сэкономить на внесении удобрений, пестицидов и других видах коррекции плодородия.
Выбор участка определяет всю дальнейшую производственную цепочку: выбор сортов подвоев и привоев, их размещение на участке, непосредственно проектные решения. Это первый и один из самых важных этапов проектирования виноградника.


Под перспективными для виноградарства землями подразумеваются территории, которые:

- заняты естественными растительными сообществами или используются для возделывания иных сельскохозяйственных культур (не винограда)
- имеют природные характеристики, схожие с одной или несколькими существующими территориями виноградарских хозяйств

Необходимо найти перспективные для возделывания винограда земли в Краснодарском крае.

#### Что дано?

- Данные о существующих виноградных хозяйствах Краснодарского края.
- Массивы климатической, геоморфологической и другой информации по Краснодарскому краю разрешением 20—200 м/пиксель.

#### Результат 

Сервис поиска перспективных земель, в котором пользователь выбирает одно или несколько существующих виноградных хозяйств, а на карте Краснодарского края выделяются области с территориями, близкими по природным характеристикам. На меру «близости» выделенных территорий пользователь может влиять выбором допустимого разброса анализируемых природных характеристик.

## О нашем решении

Решение доступно по ссылке [arbusers.ru](http://arbusers.ru).

#### Идея алгоритма подбора земель:

Итак, данных немного и, исходя из экспертных знаний, можно говорить, что они удовлетворяют гипотезе непрерывности, то есть для точек с близким признаковым описанием будут близки и условия выращивания винограда. Исходя из этого, алгоритм был разработан в три этапа:
    1) Определение меры близости объектов
    Чтобы понять, какая метрика над признаковым описанием наиболее эффективна, поставим задачу классификации, на которой переберем различные варианты и выберем наилучший. Для разметки данных воспользуемся расширенной версией гипотезы непрерывности: географически близкие земли имеют одинаковые условия для выращивания винограда. Тогда можно провести кластеризацию имеющихся виноградников по географическим координатам, после чего решать с помощью метрических алгоритмов задачу классификации над признаковыми описаниями, не включающими в себя координаты. Итогом данного этапа стал выбор евклидова расстояния как наиболее эффективной меры, описывающей схожесть земель по условиям выращивания винограда.
    2) Формирование поискового индекса
    Для начала проводится фильтрация заведомо непригодных земель, например, затопленных территорий, все территории прошедшие данный этап попадают в расширенный поисковый индекс. Тут мы сталкиваемся с тем, что индекс у нас крайне большой, поэтому для ускорения поиска появляется необходимость в его уменьшении. Для этого мы опять вспоминаем о расширенной гипотезе непрерывности и учитываем, что виноградники занимают больше места, чем 100 на 100 метров, поэтому можем объединять географически близкие земли в одну точку, а их признаковое описание просто усреднять. С учетом фильтрации части территорий и ограниченности времени на формирование индекса было принято решение сжимать данные по квантильной сетке, а на отрисовку выдавать прямоугольники, получаемые из крайних точек сжатых в данную. *Замечание:* изначально планировалось отрисовывать выпуклую оболочку сжатых точек, но так как сжатие было небольшим, а времени оставалось мало, то от этой идеи пришлось отказаться.
    3) Поиск
    Пользователь вводит запрос из нескольких виноградников, поисковая система получает на вход координаты виноградников, извлекает их признаковые представления, а затем переводит в признаковое представление, соответствующее одному "желанному" винограднику через усреднение. Затем система находит топ k территорий, наиболее близких по евклидову расстоянию между признаками, и возвращает данные для отрисовки на картах. Быстродействие системы возникает из-за использования сжатого поискового индекса, использования векторизованных вычислений и оптимальных алгоритмов.

#### Для сборки проекта в дебаге:

- Проверьте наличие пакетов, в противном случае установите их:
    - ```sudo apt install python3-pip```
    - ```sudo apt-get install python3-venv```

- При скачивании этого репозитория в настройках флаг дебага истинен, но вы можете проверить это вручную:
    - Откройте файл ```settings.py```, который лежит в ```source/vineyards/vineyards```
    - Проверьте, что параменной DEBUG присвоено значение True: ```DEBUG = True```

- Создайте виртуальное окружение в корне проекта: ```python3 -m venv .venv```

- Активируйте его: ```source .venv/bin/activate```

- После этого подгрузите все необходимые зависимости: ```pip3 install -r requirements.txt```

- Далее перейдите в приложение vineyards: ```cd source/vineyards/```

- Загрузите статику и накатите все необходимые миграции:
    - ```python3 manage.py collectstatic``` 
    - ```python3 manage.py makemigrations```
    - ```python3 manage.py migrate```
    
- Далее необходимо наполнить базу данных с помощью скрипта: ```cd .. && python3 parse_vineyards.py```

- Для запуска на 8080 порту выполните: ```cd vineyards && python3 manage.py runserver 8080```

*Проект создали Спицын Николай, Феоктистов Дмитрий, Чубенко Полина, Савичев Дмитрий, Сбродов Егор*
